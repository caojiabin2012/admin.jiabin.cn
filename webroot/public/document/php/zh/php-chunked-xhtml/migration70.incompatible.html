<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>不向后兼容的变更</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="migration70.html">从PHP 5.6.x 移植到 PHP 7.0.x</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="migration70.new-features.html">新特性</a></div>
 <div class="up"><a href="migration70.html">从PHP 5.6.x 移植到 PHP 7.0.x</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="migration70.incompatible" class="sect1">
 <h2 class="title">不向后兼容的变更</h2>

 




<div class="sect2" id="migration70.incompatible.error-handling">
 <h3 class="title">错误和异常处理相关的变更</h3>

 <p class="para">
  在 PHP 7 中，很多致命错误以及可恢复的致命错误，都被转换为异常来处理了。
  这些异常继承自 <strong class="classname">Error</strong> 类，此类实现了 
  <strong class="classname">Throwable</strong> 接口
  （所有异常都实现了这个基础接口）。
 </p>

 <p class="para">
  这也意味着，当发生错误的时候，以前代码中的一些错误处理的代码将无法被触发。
  因为在 PHP 7 版本中，已经使用抛出异常的错误处理机制了。
  （如果代码中没有捕获 <strong class="classname">Error</strong> 异常，那么会引发致命错误）。
 </p>

 <p class="para">
  PHP 7 中的错误处理的更完整的描述，请参见
  <a href="language.errors.php7.html" class="link">PHP 7 错误处理</a>。
  本迁移指导主要是列出对兼容性有影响的变更。
 </p>

 <div class="sect3" id="migration70.incompatible.error-handling.set-exception-handler">
  <h4 class="title">
   <span class="function"><a href="function.set-exception-handler.html" class="function">set_exception_handler()</a></span> 不再保证收到的一定是 <a href="class.exception.html" class="classname">Exception</a> 对象
  </h4>

  <p class="para">
   抛出 <strong class="classname">Error</strong> 对象时，如果 <span class="function"><a href="function.set-exception-handler.html" class="function">set_exception_handler()</a></span> 里的异常处理代码声明了类型 <a href="class.exception.html" class="classname">Exception</a> ，将会导致 fatal error。
  </p>

  <p class="para">
   想要异常处理器同时支持 PHP5 和 PHP7，应该删掉异常处理器里的类型声明。如果代码仅仅是升级到 PHP7，则可以把类型 <a href="class.exception.html" class="classname">Exception</a>  替换成 <strong class="classname">Throwable</strong>。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;PHP&nbsp;5&nbsp;时代的代码将会出现问题<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">handler</span><span style="color: #007700">(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{&nbsp;...&nbsp;}<br /></span><span style="color: #0000BB">set_exception_handler</span><span style="color: #007700">(</span><span style="color: #DD0000">'handler'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;兼容&nbsp;PHP&nbsp;5&nbsp;和&nbsp;7<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">)&nbsp;{&nbsp;...&nbsp;}<br /><br /></span><span style="color: #FF8000">//&nbsp;仅支持&nbsp;PHP&nbsp;7<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">handler</span><span style="color: #007700">(</span><span style="color: #0000BB">Throwable&nbsp;$e</span><span style="color: #007700">)&nbsp;{&nbsp;...&nbsp;}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>
 
 <div class="sect3" id="migration70.incompatible.error-handling.constructors">
  <h4 class="title">当内部构造器失败的时候，总是抛出异常</h4>

  <p class="para">
   在之前版本中，如果内部类的构造器出错，会返回 <strong><code>NULL</code></strong> 
   或者一个不可用的对象。
   从 PHP 7 开始，如果内部类构造器发生错误，
   那么会抛出异常。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.error-handling.parse">
  <h4 class="title">解析错误会抛出 <strong class="classname">ParseError</strong> 异常</h4>

  <p class="para">
   解析错误会抛出 <strong class="classname">ParseError</strong> 异常。
   对于 <span class="function"><a href="function.eval.html" class="function">eval()</a></span> 函数，需要将其包含到一个
   <a href="language.exceptions.html#language.exceptions.catch" class="link"><em>catch</em></a> 代码块中来处理解析错误。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.error-handling.strict">
  <h4 class="title">E_STRICT 警告级别变更</h4>

  <p class="para">
   原有的 <strong><code>E_STRICT</code></strong> 警告都被迁移到其他级别。
   <strong><code>E_STRICT</code></strong> 常量会被保留，所以调用 
   <em>error_reporting(E_ALL|E_STRICT)</em> 不会引发错误。
  </p>
  <p class="para">
   <table class="doctable table">
    <caption><strong><strong><code>E_STRICT</code></strong> 警告级别变更</strong></caption>
     
      <thead>
       <tr>
        <th>场景</th>
        <th>新的级别/行为</th>
       </tr>

      </thead>

      <tbody class="tbody">
       <tr>
        <td>将资源类型的变量用作键来进行索引</td>
        <td><strong><code>E_NOTICE</code></strong></td>
       </tr>

       <tr>
        <td>抽象静态方法</td>
        <td>不再警告，会引发错误</td>
       </tr>

       <tr>
        <td>重复定义构造器函数</td>
        <td>不再警告，会引发错误</td>
       </tr>

       <tr>
        <td>在继承的时候，方法签名不匹配</td>
        <td><strong><code>E_WARNING</code></strong></td>
       </tr>

       <tr>
        <td>在两个 trait 中包含相同的（兼容的）属性</td>
        <td>不再警告，会引发错误</td>
       </tr>

       <tr>
        <td>以非静态调用的方式访问静态属性</td>
        <td><strong><code>E_NOTICE</code></strong></td>
       </tr>

       <tr>
        <td>变量应该以引用的方式赋值</td>
        <td><strong><code>E_NOTICE</code></strong></td>
       </tr>

       <tr>
        <td>变量应该以引用的方式传递（到函数参数中）</td>
        <td><strong><code>E_NOTICE</code></strong></td>
       </tr>

       <tr>
        <td>以静态方式调用实例方法</td>
        <td><strong><code>E_DEPRECATED</code></strong></td>
       </tr>

      </tbody>
     
    </table>

   </p>
 </div>
</div>



 




<div class="sect2" id="migration70.incompatible.variable-handling">
 <h3 class="title">关于变量处理的变化</h3>

 <p class="para">
  PHP 7 现在使用了抽象语法树来解析源代码。这为语言带来了许多改进，由于之前的PHP的解释器的限制所不可能实现的，
  但出于一致性的原因导致了一些特殊例子的变动，而这些变动打破了向后兼容。
  在这一章中将详细介绍这些例子。
 </p>

 <div class="sect3" id="migration70.incompatible.variable-handling.indirect">
  <h4 class="title">
   关于间接使用变量、属性和方法的变化
  </h4>

  <p class="para">
   对变量、属性和方法的间接调用现在将严格遵循从左到右的顺序来解析，而不是之前的混杂着几个特殊案例的情况。
   下面这张表说明了这个解析顺序的变化。
  </p>

  <p class="para">
   <table class="doctable table">
    <caption><strong>间接调用的表达式的新旧解析顺序</strong></caption>
    
     <thead>
      <tr>
       <th>表达式</th>
       <th>PHP 5 的解析方式</th>
       <th>PHP 7 的解析方式</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>
        <code class="code">$$foo[&#039;bar&#039;][&#039;baz&#039;]</code>
       </td>
       <td>
        <code class="code">${$foo[&#039;bar&#039;][&#039;baz&#039;]}</code>
       </td>
       <td>
        <code class="code">($$foo)[&#039;bar&#039;][&#039;baz&#039;]</code>
       </td>
      </tr>

      <tr>
       <td>
        <code class="code">$foo-&gt;$bar[&#039;baz&#039;]</code>
       </td>
       <td>
        <code class="code">$foo-&gt;{$bar[&#039;baz&#039;]}</code>
       </td>
       <td>
        <code class="code">($foo-&gt;$bar)[&#039;baz&#039;]</code>
       </td>
      </tr>

      <tr>
       <td>
        <code class="code">$foo-&gt;$bar[&#039;baz&#039;]()</code>
       </td>
       <td>
        <code class="code">$foo-&gt;{$bar[&#039;baz&#039;]}()</code>
       </td>
       <td>
        <code class="code">($foo-&gt;$bar)[&#039;baz&#039;]()</code>
       </td>
      </tr>

      <tr>
       <td>
        <code class="code">Foo::$bar[&#039;baz&#039;]()</code>
       </td>
       <td>
        <code class="code">Foo::{$bar[&#039;baz&#039;]}()</code>
       </td>
       <td>
        <code class="code">(Foo::$bar)[&#039;baz&#039;]()</code>
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>

  <p class="para">
   使用了旧的从右到左的解析顺序的代码必须被重写，明确的使用圆括号来表明顺序（参见上表）。
   这样使得代码既保持了与PHP 7.x的前向兼容性，又保持了与PHP 5.x的后向兼容性。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.variable-handling.list">
  <h4 class="title">关于<span class="function"><a href="function.list.html" class="function">list()</a></span>处理方式的变更</h4>

  <div class="sect4" id="migration70.incompatible.variable-handling.list.order">
   <h5 class="title">
    <span class="function"><a href="function.list.html" class="function">list()</a></span> 不再以反向的顺序来进行赋值
   </h5>

   <p class="para">
    <span class="function"><a href="function.list.html" class="function">list()</a></span> 现在会按照变量定义的顺序来给他们进行赋值，而非反过来的顺序。
    通常来说，这只会影响<span class="function"><a href="function.list.html" class="function">list()</a></span> 与数组的<code class="code">[]</code>操作符一起使用的案例，如下所示：
   </p>

   <div class="informalexample">
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">list(</span><span style="color: #0000BB">$a</span><span style="color: #007700">[],&nbsp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">[],&nbsp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">[])&nbsp;=&nbsp;[</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <p class="para">Output of the above example in PHP 5:</p>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(3) {
  [0]=&gt;
  int(3)
  [1]=&gt;
  int(2)
  [2]=&gt;
  int(1)
}
</pre></div>
    </div>
    <p class="para">Output of the above example in PHP 7:</p>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(3) {
  [0]=&gt;
  int(1)
  [1]=&gt;
  int(2)
  [2]=&gt;
  int(3)
}
</pre></div>
    </div>
   </div>

   <p class="para">
    总之，我们推荐不要依赖<span class="function"><a href="function.list.html" class="function">list()</a></span>的赋值顺序，因为这是一个在未来也许会变更的实现细节。
   </p>
  </div>

  <div class="sect4" id="migration70.incompatible.variable-handling.list.empty">
   <h5 class="title">空的<span class="function"><a href="function.list.html" class="function">list()</a></span>赋值支持已经被移除</h5>

   <p class="para">
    <span class="function"><a href="function.list.html" class="function">list()</a></span> 结构现在不再能是空的。如下的例子不再被允许：
   </p>

   <div class="informalexample">
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">list()&nbsp;=&nbsp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">;<br />list(,,)&nbsp;=&nbsp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">;<br />list(</span><span style="color: #0000BB">$x</span><span style="color: #007700">,&nbsp;list(),&nbsp;</span><span style="color: #0000BB">$y</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </div>

  <div class="sect4" id="migration70.incompatible.variable-handling.list.string">
   <h5 class="title"><span class="function"><a href="function.list.html" class="function">list()</a></span>不再能解开<span class="type"><a href="language.types.string.html" class="type string">string</a></span></h5>

   <p class="para">
    <span class="function"><a href="function.list.html" class="function">list()</a></span> 不再能解开字符串（<span class="type"><a href="language.types.string.html" class="type string">string</a></span>）变量。
    你可以使用<span class="function"><a href="function.str-split.html" class="function">str_split()</a></span>来代替它。
   </p>
  </div>
 </div>

 <div class="sect3" id="migration70.incompatible.variable-handling.array-order">
  <h4 class="title">
   Array ordering when elements are automatically created during by reference
   assignments has changed
  </h4>

  <p class="para">
   The order of the elements in an array has changed when those elements have
   been automatically created by referencing them in a by reference
   assignment. For example:
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$array&nbsp;</span><span style="color: #007700">=&nbsp;[];<br /></span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">"a"</span><span style="color: #007700">]&nbsp;=&amp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">"b"</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">"b"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">Output of the above example in PHP 5:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
array(2) {
  [&quot;b&quot;]=&gt;
  &amp;int(1)
  [&quot;a&quot;]=&gt;
  &amp;int(1)
}
</pre></div>
   </div>
   <p class="para">Output of the above example in PHP 7:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
array(2) {
  [&quot;a&quot;]=&gt;
  &amp;int(1)
  [&quot;b&quot;]=&gt;
  &amp;int(1)
}
</pre></div>
   </div>
  </div>
 </div>

 <div class="sect3" id="migration70.incompatible.variable-handling.global">
  <h4 class="title"><a href="language.variables.scope.html#language.variables.scope.global" class="link"><em>global</em></a> 只接受简单变量</h4>

  <p class="para">
   <a href="language.variables.variable.html" class="link">可变变量</a>不再能够与 <a href="language.variables.scope.html#language.variables.scope.global" class="link"><em>global</em></a> 关键字一起使用。
   如果需要的话可以使用圆括号来模拟之前的行为。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">f</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Valid&nbsp;in&nbsp;PHP&nbsp;5&nbsp;only.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">global&nbsp;$</span><span style="color: #0000BB">$foo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bar</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Valid&nbsp;in&nbsp;PHP&nbsp;5&nbsp;and&nbsp;7.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">global&nbsp;${</span><span style="color: #0000BB">$foo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bar</span><span style="color: #007700">};<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  <p class="para">
   作为一个通用的准则，<a href="language.variables.scope.html#language.variables.scope.global" class="link"><em>global</em></a> 一个除了裸的变量以外的任何东西都是不被推荐的。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.variable-handling.parentheses">
  <h4 class="title">
   函数参数附近的括号不再影响行为
  </h4>

  <p class="para">
   In PHP 5, using redundant parentheses around a function argument could
   quiet strict standards warnings when the function argument was passed by
   reference. The warning will now always be issued.
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">getArray</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">];<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">squareArray</span><span style="color: #007700">(array&nbsp;&amp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">as&nbsp;&amp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$v&nbsp;</span><span style="color: #007700">**=&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Generates&nbsp;a&nbsp;warning&nbsp;in&nbsp;PHP&nbsp;7.<br /></span><span style="color: #0000BB">squareArray</span><span style="color: #007700">((</span><span style="color: #0000BB">getArray</span><span style="color: #007700">()));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">以上例程会输出：</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
Notice: Only variables should be passed by reference in /tmp/test.php on line 13
</pre></div>
   </div>
  </div>
 </div>
</div>



 




<div class="sect2" id="migration70.incompatible.foreach">
 <h3 class="title"> <a href="control-structures.foreach.html" class="link">foreach</a>的变化</h3>

 <p class="para">
  <a href="control-structures.foreach.html" class="link">foreach</a>发生了细微的变化，控制结构， 主要围绕阵列的内部数组指针和迭代处理的修改。

 </p>

 <div class="sect3" id="migration70.incompatible.foreach.array-pointer">
  <h4 class="title"><a href="control-structures.foreach.html" class="link">foreach</a>不再改变内部数组指针</h4>

  <p class="para">
   在PHP7之前，当数组通过 <a href="control-structures.foreach.html" class="link">foreach</a> 迭代时，数组指针会移动。现在开始，不再如此，见下面代码
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$array&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">];<br />foreach&nbsp;(</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">as&nbsp;&amp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">current</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">));<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">Output of the above example in PHP 5:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
int(1)
int(2)
bool(false)
</pre></div>
   </div>
   <p class="para">Output of the above example in PHP 7:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
int(0)
int(0)
int(0)
</pre></div>
   </div>
  </div>
 </div>

 <div class="sect3" id="migration70.incompatible.foreach.by-value">
  <h4 class="title"><a href="control-structures.foreach.html" class="link">foreach</a> 通过值遍历时，操作的值为数组的副本</h4>

  <p class="para">
   当默认使用通过值遍历数组时，<a href="control-structures.foreach.html" class="link">foreach</a> 实际操作的是数组的迭代副本，而非数组本身。这就意味着，foreach 中的操作不会修改原数组的值。   
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.foreach.by-ref">
  <h4 class="title"><a href="control-structures.foreach.html" class="link">foreach</a>通过引用遍历时，有更好的迭代特性</h4>

  <p class="para">
   当使用引用遍历数组时，现在 <a href="control-structures.foreach.html" class="link">foreach</a> 在迭代中能更好的跟踪变化。例如，在迭代中添加一个迭代值到数组中，参考下面的代码：
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$array&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br />foreach&nbsp;(</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">as&nbsp;&amp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$val</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">Output of the above example in PHP 5:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
int(0)
</pre></div>
   </div>
   <p class="para">Output of the above example in PHP 7:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
int(0)
int(1)
</pre></div>
   </div>
  </div>
 </div>

 <div class="sect3" id="migration70.incompatible.foreach.object">
  <h4 class="title"> 非<strong class="classname">Traversable</strong> 对象的遍历</h4>

  <p class="para">
   迭代一个非<strong class="classname">Traversable</strong>对象将会与迭代一个引用数组的行为相同。
   这将导致在对象添加或删除属性时，<a href="migration70.incompatible.html#migration70.incompatible.foreach.by-ref" class="link"><a href="control-structures.foreach.html" class="link">foreach</a>通过引用遍历时，有更好的迭代特性</a>也能被应用
  </p>
 </div>
</div>



 


<div class="sect2" id="migration70.incompatible.integers">
 <h3 class="title">Changes to <span class="type"><a href="language.types.integer.html" class="type integer">integer</a></span> handling</h3>

 <div class="sect3" id="migration70.incompatible.integers.invalid-octals">
  <h4 class="title">Invalid octal literals</h4>

  <p class="para">
   Previously, octal literals that contained invalid numbers were silently
   truncated (<em>0128</em> was taken as <em>012</em>).
   Now, an invalid octal literal will cause a parse error.
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.integers.negative-bitshift">
  <h4 class="title">Negative bitshifts</h4>

  <p class="para">
   Bitwise shifts by negative numbers will now throw an
   <strong class="classname">ArithmeticError</strong>:
  </p>
  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">&gt;&gt;&nbsp;-</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

    <p class="para">Output of the above example in PHP 5:</p>
    <div class="example-contents screen">
<div class="cdata"><pre>
int(0)
</pre></div>
    </div>
    <p class="para">Output of the above example in PHP 7:</p>
    <div class="example-contents screen">
<div class="cdata"><pre>
Fatal error: Uncaught ArithmeticError: Bit shift by negative number in /tmp/test.php:2
Stack trace:
#0 {main}
  thrown in /tmp/test.php on line 2
</pre></div>
    </div>
  </div>
 </div>

 <div class="sect3" id="migration70.incompatible.integers.out-of-range">
  <h4 class="title">Out of range bitshifts</h4>

  <p class="para">
   Bitwise shifts (in either direction) beyond the bit width of an
   <span class="type"><a href="language.types.integer.html" class="type integer">integer</a></span> will always result in 0. Previously, the behaviour of
   such shifts was architecture dependent.
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.integers.div-by-zero">
  <h4 class="title">Changes to Division By Zero</h4>

  <p class="para">
   Previously, when 0 was used as the divisor for either the divide (/) or
   modulus (%) operators, an E_WARNING would be emitted and
   <strong><code>false</code></strong> would be returned. Now, the divide operator
   returns a float as either +INF, -INF, or NAN, as specified by IEEE 754. The modulus operator E_WARNING
   has been removed and will throw a <strong class="classname">DivisionByZeroError</strong>
   exception.
  </p>
  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">/</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">/</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">%</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">Output of the above example in PHP 5:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
Warning: Division by zero in %s on line %d
bool(false)

Warning: Division by zero in %s on line %d
bool(false)

Warning: Division by zero in %s on line %d
bool(false)
</pre></div>
   </div>
   <p class="para">Output of the above example in PHP 7:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
Warning: Division by zero in %s on line %d
float(INF)

Warning: Division by zero in %s on line %d
float(NAN)

PHP Fatal error:  Uncaught DivisionByZeroError: Modulo by zero in %s line %d
</pre></div>
   </div>
  </div>
 </div>
</div>



 




<div class="sect2" id="migration70.incompatible.strings">
 <h3 class="title"><span class="type"><a href="language.types.string.html" class="type string">string</a></span>处理上的调整</h3>

 <div class="sect3" id="migration70.incompatible.strings.hex">
  <h4 class="title">十六进制字符串不再被认为是数字</h4>

  <p class="para">
   含十六进制字符串不再被认为是数字。例如：
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />var_dump</span><span style="color: #007700">(</span><span style="color: #DD0000">"0x123"&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">"291"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">is_numeric</span><span style="color: #007700">(</span><span style="color: #DD0000">"0x123"</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #DD0000">"0xe"&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #DD0000">"0x1"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #DD0000">"foo"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"0x1"</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">Output of the above example in PHP 5:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
bool(true)
bool(true)
int(15)
string(2) &quot;oo&quot;
</pre></div>
   </div>
   <p class="para">Output of the above example in PHP 7:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
bool(false)
bool(false)
int(0)

Notice: A non well formed numeric value encountered in /tmp/test.php on line 5
string(3) &quot;foo&quot;
</pre></div>
   </div>
  </div>

  <p class="para">
   <span class="function"><a href="function.filter-var.html" class="function">filter_var()</a></span> 函数可以用于检查一个
   <span class="type"><a href="language.types.string.html" class="type string">string</a></span> 是否含有十六进制数字,并将其转换为<span class="type"><a href="language.types.integer.html" class="type integer">integer</a></span>:
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"0xffff"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$int&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">filter_var</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">FILTER_VALIDATE_INT</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">FILTER_FLAG_ALLOW_HEX</span><span style="color: #007700">);<br />if&nbsp;(</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$int</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #DD0000">"Invalid&nbsp;integer!"</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$int</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;int(65535)<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>

 <div class="sect3" id="migration70.incompatible.strings.unicode-escapes">
  <h4 class="title"><em>\u{</em> 可能引起错误</h4>

  <p class="para">
   由于新的
   <a href="migration70.new-features.html#migration70.new-features.unicode-codepoint-escape-syntax" class="link">Unicode codepoint escape syntax</a>语法，
   紧连着无效序列并包含<em>\u{</em> 的字串可能引起致命错误。 为了避免这一报错，应该避免反斜杠开头。
  </p>
 </div>
</div>



 




<div class="sect2" id="migration70.incompatible.removed-functions">
 <h3 class="title">被移除的函数（Removed functions）</h3>

 <div class="sect3" id="migration70.incompatible.removed-functions.call-user-method">
  <h4 class="title">
   <span class="function"><a href="function.call-user-method.html" class="function">call_user_method()</a></span> and
   <span class="function"><a href="function.call-user-method-array.html" class="function">call_user_method_array()</a></span>
  </h4>

  <p class="para">
   这两个函数从PHP 4.1.0开始被废弃，应该使用<span class="function"><a href="function.call-user-func.html" class="function">call_user_func()</a></span> 和
   <span class="function"><a href="function.call-user-func-array.html" class="function">call_user_func_array()</a></span>。 你也可以考虑使用
   <a href="functions.variable-functions.html" class="link">变量函数</a>
   或者
   <a href="functions.arguments.html#functions.variable-arg-list.new" class="link"><em>...</em></a>
   操作符。
  </p>
 </div>
 
 <div class="sect3" id="migration70.incompatible.removed-functions.ereg">
  <h4 class="title">
   所有的 ereg* 函数
  </h4>
  <p class="para">
   所有 <a href="book.regex.html" class="link">ereg</a> 系列函数被删掉了。
   <a href="book.pcre.html" class="link">PCRE</a> 作为推荐的替代品。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.removed-functions.mcrypt">
  <h4 class="title"><a href="book.mcrypt.html" class="link">mcrypt</a> 别名</h4>

  <p class="para">
   已废弃的 <span class="function"><a href="function.mcrypt-generic-end.html" class="function">mcrypt_generic_end()</a></span> 函数已被移除，请使用<span class="function"><a href="function.mcrypt-generic-deinit.html" class="function">mcrypt_generic_deinit()</a></span>代替。
  </p>

  <p class="para">
   此外，已废弃的 <span class="function"><a href="function.mcrypt-ecb.html" class="function">mcrypt_ecb()</a></span>,
   <span class="function"><a href="function.mcrypt-cbc.html" class="function">mcrypt_cbc()</a></span>, <span class="function"><a href="function.mcrypt-cfb.html" class="function">mcrypt_cfb()</a></span> 和
   <span class="function"><a href="function.mcrypt-ofb.html" class="function">mcrypt_ofb()</a></span> 函数已被移除，请配合恰当的<strong><code>MCRYPT_MODE_*</code></strong> 常量来使用 <span class="function"><a href="function.mcrypt-decrypt.html" class="function">mcrypt_decrypt()</a></span>进行代替。
   
  </p>
 </div>

 
 <div class="sect3" id="migration70.incompatible.removed-functions.mysql">
  <h4 class="title">
   所有 ext/mysql 函数
  </h4>
  <p class="para">
   所有 <a href="book.mysql.html" class="link">ext/mysql</a> 函数已被删掉了。
   如何选择不同的 MySQL API，详情请见
   <a href="mysqlinfo.api.choosing.html" class="link">选择 MySQL API</a>。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.removed-functions.mssql">
  <h4 class="title">
   所有 ext/mssql 函数
  </h4>
  <p class="para">
   所有 <a href="book.mssql.html" class="link">ext/mssql</a> 函数已被删掉了。
   替代品的列表，参见
   <a href="intro.mssql.html" class="link">MSSQL 介绍</a>。
  </p>
 </div>
 
 <div class="sect3" id="migration70.incompatible.removed-functions.intl">
  <h4 class="title"><a href="book.intl.html" class="link">intl</a> 别名</h4>

  <p class="para">
   已废弃的 <span class="function"><a href="intldateformatter.settimezoneid.html" class="function">datefmt_set_timezone_id()</a></span> 和
   <span class="methodname"><a href="intldateformatter.settimezoneid.html" class="methodname">IntlDateFormatter::setTimeZoneID()</a></span> 函数已被移除，请使用 <span class="function"><a href="intldateformatter.settimezone.html" class="function">datefmt_set_timezone()</a></span> 与
   <span class="methodname"><a href="intldateformatter.settimezone.html" class="methodname">IntlDateFormatter::setTimeZone()</a></span>代替。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.removed-functions.magic-quotes">
  <h4 class="title"><span class="function"><a href="function.set-magic-quotes-runtime.html" class="function">set_magic_quotes_runtime()</a></span></h4>

  <p class="para">
   <span class="function"><a href="function.set-magic-quotes-runtime.html" class="function">set_magic_quotes_runtime()</a></span>, 和它的别名
   <span class="function"><a href="function.magic-quotes-runtime.html" class="function">magic_quotes_runtime()</a></span>已被移除. 它们在PHP 5.3.0中已经被废弃,并且
   在<a href="migration54.incompatible.html" class="link">in PHP 5.4.0</a>也由于魔术引号的废弃而失去功能。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.removed-functions.set-socket-blocking">
  <h4 class="title"><span class="function"><a href="function.set-socket-blocking.html" class="function">set_socket_blocking()</a></span></h4>

  <p class="para">
   已废弃的 <span class="function"><a href="function.set-socket-blocking.html" class="function">set_socket_blocking()</a></span>  函数已被移除，请使用<span class="function"><a href="function.stream-set-blocking.html" class="function">stream_set_blocking()</a></span>代替。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.removed-functions.dl">
  <h4 class="title"><span class="function"><a href="function.dl.html" class="function">dl()</a></span> in PHP-FPM</h4>

  <p class="para">
   <span class="function"><a href="function.dl.html" class="function">dl()</a></span>在 PHP-FPM 不再可用，在 CLI 和 embed SAPIs 中仍可用。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.removed-functions.gd">
  <h4 class="title"><a href="book.image.html" class="link">GD</a> Type1 functions</h4>

  <p class="para">
   Support for PostScript Type1 fonts has been removed from the GD extension,
   resulting in the removal of the following functions:
  </p>

  <ul class="itemizedlist">
   <li class="listitem">
    <span class="simpara">
     <span class="function"><a href="function.imagepsbbox.html" class="function">imagepsbbox()</a></span>
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     <span class="function"><a href="function.imagepsencodefont.html" class="function">imagepsencodefont()</a></span>
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     <span class="function"><a href="function.imagepsextendfont.html" class="function">imagepsextendfont()</a></span>
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     <span class="function"><a href="function.imagepsfreefont.html" class="function">imagepsfreefont()</a></span>
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     <span class="function"><a href="function.imagepsloadfont.html" class="function">imagepsloadfont()</a></span>
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     <span class="function"><a href="function.imagepsslantfont.html" class="function">imagepsslantfont()</a></span>
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     <span class="function"><a href="function.imagepstext.html" class="function">imagepstext()</a></span>
    </span>
   </li>
  </ul>

  <p class="para">
   推荐使用 TrueType 字体和相关的函数作为替代。
  </p>
 </div>
</div>



 




<div class="sect2" id="migration70.incompatible.removed-ini-directives">
 <h3 class="title">被移除掉的 INI 配置指令</h3>

 <div class="sect3" id="migration70.incompatible.removed-ini-directives.features">
  <h4 class="title">被移除的功能</h4>

  <p class="para">
   以下 INI 配置指令已经被移除，同时移除的还有其对应的功能
  </p>

  <ul class="itemizedlist">
   <li class="listitem">
    <span class="simpara">
     <a href="ini.core.html#ini.always-populate-raw-post-data" class="link"><code class="parameter">always_populate_raw_post_data</code></a>
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     <a href="ini.core.html#ini.asp-tags" class="link"><code class="parameter">asp_tags</code></a>
    </span>
   </li>
  </ul>
 </div>

 <div class="sect3" id="migration70.incompatible.removed-ini-directives.xsl">
  <h4 class="title"><code class="parameter">xsl.security_prefs</code></h4>

  <p class="para">
   <code class="parameter">xsl.security_prefs</code> 指令被移除
   在预处理的时候，取而代之的方法 <span class="methodname"><a href="xsltprocessor.setsecurityprefs.html" class="methodname">XsltProcessor::setSecurityPrefs()</a></span>
   应该被调用到
  </p>
 </div>
</div>



 




<div class="sect2" id="migration70.incompatible.other">
 <h3 class="title">其他向后兼容相关的变更</h3>

 <div class="sect3" id="migration70.incompatible.other.new-by-ref">
  <h4 class="title">new 操作符创建的对象不能以引用方式赋值给变量</h4>

  <p class="para">
   <a href="language.oop5.basic.html#language.oop5.basic.new" class="link"><em>new</em></a> 语句创建的对象不能
   以引用的方式赋值给变量。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">C&nbsp;</span><span style="color: #007700">{}<br /></span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&amp;&nbsp;new&nbsp;</span><span style="color: #0000BB">C</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">Output of the above example in PHP 5:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
Deprecated: Assigning the return value of new by reference is deprecated in /tmp/test.php on line 3
</pre></div>
   </div>
   <p class="para">Output of the above example in PHP 7:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
Parse error: syntax error, unexpected &#039;new&#039; (T_NEW) in /tmp/test.php on line 3
</pre></div>
   </div>
  </div>
 </div>

 <div class="sect3" id="migration70.incompatible.other.classes">
  <h4 class="title">无效的类、接口以及 trait 命名</h4>

  <p class="para">
   不能以下列名字来命名类、接口以及 trait：
  </p>

  <ul class="itemizedlist">
   <li class="listitem">
    <span class="simpara"><span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span></span>
   </li>
   <li class="listitem">
    <span class="simpara"><span class="type"><a href="language.types.integer.html" class="type int">int</a></span></span>
   </li>
   <li class="listitem">
    <span class="simpara"><span class="type"><a href="language.types.float.html" class="type float">float</a></span></span>
   </li>
   <li class="listitem">
    <span class="simpara"><span class="type"><a href="language.types.string.html" class="type string">string</a></span></span>
   </li>
   <li class="listitem">
    <span class="simpara"><strong><code>NULL</code></strong></span>
   </li>
   <li class="listitem">
    <span class="simpara"><strong><code>TRUE</code></strong></span>
   </li>
   <li class="listitem">
    <span class="simpara"><strong><code>FALSE</code></strong></span>
   </li>
  </ul>

  <p class="para">
   此外，也不要使用下列的名字来命名类、接口以及 trait。虽然在 PHP 7.0 中，
   这并不会引发错误，
   但是这些名字是保留给将来使用的。
  </p>

  <ul class="itemizedlist">
   <li class="listitem">
    <span class="simpara"><span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span></span>
   </li>
   <li class="listitem">
    <span class="simpara"><span class="type"><a href="language.types.object.html" class="type object">object</a></span></span>
   </li>
   <li class="listitem">
    <span class="simpara"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span></span>
   </li>
   <li class="listitem">
    <span class="simpara"><span class="type"><span class="type numeric">numeric</span></span></span>
   </li>
  </ul>
 </div>

 <div class="sect3" id="migration70.incompatible.other.php-tags">
  <h4 class="title">移除了 ASP 和 script PHP 标签</h4>

  <p class="para">
   使用类似 ASP 的标签，以及 script 标签来区分 PHP 代码的方式被移除。
   受到影响的标签有：
  </p>

  <table class="doctable table">
   <caption><strong>被移除的 ASP 和 script 标签</strong></caption>
   
    <thead>
     <tr>
      <th>开标签</th>
      <th>闭标签</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td><code class="code">&lt;%</code></td>
      <td><code class="code">%&gt;</code></td>
     </tr>

     <tr>
      <td><code class="code">&lt;%=</code></td>
      <td><code class="code">%&gt;</code></td>
     </tr>

     <tr>
      <td><code class="code">&lt;script language=&quot;php&quot;&gt;</code></td>
      <td><code class="code">&lt;/script&gt;</code></td>
     </tr>

    </tbody>
   
  </table>

 </div>

 <div class="sect3" id="migration70.incompatible.other.incompatible-this">
  <h4 class="title">从不匹配的上下文发起调用</h4>

  <p class="para">
   在不匹配的上下文中以静态方式调用非静态方法，
   <a href="migration56.deprecated.html#migration56.deprecated.incompatible-context" class="link">在 PHP 5.6 中已经废弃</a>，
   但是在 PHP 7.0 中，
   会导致被调用方法中未定义 <em>$this</em> 变量，以及此行为已经废弃的警告。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">A&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">test</span><span style="color: #007700">()&nbsp;{&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">);&nbsp;}<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;注意：并没有从类&nbsp;A&nbsp;继承<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">B&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">callNonStaticMethodOfA</span><span style="color: #007700">()&nbsp;{&nbsp;</span><span style="color: #0000BB">A</span><span style="color: #007700">::</span><span style="color: #0000BB">test</span><span style="color: #007700">();&nbsp;}<br />}<br /><br />(new&nbsp;</span><span style="color: #0000BB">B</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">callNonStaticMethodOfA</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">Output of the above example in PHP 5.6:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
Deprecated: Non-static method A::test() should not be called statically, assuming $this from incompatible context in /tmp/test.php on line 8
object(B)#1 (0) {
}
</pre></div>
   </div>
   <p class="para">Output of the above example in PHP 7:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
Deprecated: Non-static method A::test() should not be called statically in /tmp/test.php on line 8

Notice: Undefined variable: this in /tmp/test.php on line 3
NULL
</pre></div>
   </div>
  </div>
 </div>

 <div class="sect3" id="migration70.incompatible.other.yield">
  <h4 class="title"><a href="language.generators.syntax.html#control-structures.yield" class="link">yield</a> 变更为右联接运算符</h4>

  <p class="para">
   在使用 <a href="language.generators.syntax.html#control-structures.yield" class="link">yield</a> 关键字的时候，不再需要括号，
   并且它变更为右联接操作符，其运算符优先级介于
   <em>print</em> 和 <em>=&gt;</em> 之间。
   这可能导致现有代码的行为发生改变：
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">yield&nbsp;</span><span style="color: #007700">-</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;在之前版本中会被解释为：<br /></span><span style="color: #007700">echo&nbsp;(</span><span style="color: #0000BB">yield</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;现在，它将被解释为：<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">yield&nbsp;</span><span style="color: #007700">(-</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">yield&nbsp;$foo&nbsp;</span><span style="color: #007700">or&nbsp;die;<br /></span><span style="color: #FF8000">//&nbsp;在之前版本中会被解释为：<br /></span><span style="color: #0000BB">yield&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$foo&nbsp;</span><span style="color: #007700">or&nbsp;die);<br /></span><span style="color: #FF8000">//&nbsp;现在，它将被解释为：<br /></span><span style="color: #007700">(</span><span style="color: #0000BB">yield&nbsp;$foo</span><span style="color: #007700">)&nbsp;or&nbsp;die;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  <p class="para">
   可以通过使用括号来消除歧义。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.other.func-parameters">
  <h4 class="title">函数定义不可以包含多个同名参数</h4>

  <p class="para">
   在函数定义中，不可以包含两个或多个同名的参数。
   例如，下面代码中的函数定义会触发
   <strong><code>E_COMPILE_ERROR</code></strong> 错误：
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">foo</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$unused</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$unused</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>

 <div class="sect3" id="migration70.incompatible.other.multiple-default">
  <h4 class="title">Switch 语句不可以包含多个 default 块</h4>

  <p class="para">
   在 switch 语句中，两个或者多个 default 块的代码已经不再被支持。
   例如，下面代码中的 switch 语句会触发
   <strong><code>E_COMPILE_ERROR</code></strong> 错误：
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">switch&nbsp;(</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;default:<br />&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;default:<br />&nbsp;&nbsp;&nbsp;&nbsp;break;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>
 
 <div class="sect3" id="migration70.incompatible.other.func-parameter-modified">
  <h4 class="title">在函数中检视参数值会返回 <em class="emphasis">当前</em> 的值</h4>

  <p class="para">
   当在函数代码中使用 <span class="function"><a href="function.func-get-arg.html" class="function">func_get_arg()</a></span> 或 
   <span class="function"><a href="function.func-get-args.html" class="function">func_get_args()</a></span> 函数来检视参数值，
   或者使用 <span class="function"><a href="function.debug-backtrace.html" class="function">debug_backtrace()</a></span> 函数查看回溯跟踪，
   以及在异常回溯中所报告的参数值是指参数当前的值（有可能是已经被函数内的代码改变过的值），
   而不再是参数被传入函数时候的原始值了。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">foo</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$x</span><span style="color: #007700">++;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">func_get_arg</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">));<br />}<br /></span><span style="color: #0000BB">foo</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);</span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">Output of the above example in PHP 5:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
1
</pre></div>
   </div>
   <p class="para">Output of the above example in PHP 7:</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
2
</pre></div>
   </div>
  </div>
 </div>
 
 <div class="sect3" id="migration70.incompatible.other.http-raw-post-data">
  <h4 class="title"><var class="varname"><var class="varname"><a href="reserved.variables.httprawpostdata.html" class="classname">$HTTP_RAW_POST_DATA</a></var></var> 被移除</h4>

  <p class="para">
   不再提供 <var class="varname"><var class="varname"><a href="reserved.variables.httprawpostdata.html" class="classname">$HTTP_RAW_POST_DATA</a></var></var> 变量。 请使用
   <a href="wrappers.php.html#wrappers.php.input" class="link"><em>php://input</em></a>
   作为替代。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.other.ini-comments">
  <h4 class="title">INI 文件中 <em>#</em> 注释格式被移除</h4>

  <p class="para">
   在 INI 文件中，不再支持以 <em>#</em> 开始的注释行，
   请使用 <em>;</em>（分号）来表示注释。
   此变更适用于 <var class="filename">php.ini</var> 以及用 <span class="function"><a href="function.parse-ini-file.html" class="function">parse_ini_file()</a></span> 和 <span class="function"><a href="function.parse-ini-string.html" class="function">parse_ini_string()</a></span>
   函数来处理的文件。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.other.json-to-jsond">
  <h4 class="title">JSON 扩展已经被 JSOND 取代</h4>

  <p class="para">
   JSON 扩展已经被 JSOND 扩展取代。
   对于数值的处理，有以下两点需要注意的：
   第一，数值不能以点号（.）结束
   （例如，数值 <em>34.</em> 必须写作 
   <em>34.0</em> 或 <em>34</em>）。
   第二，如果使用科学计数法表示数值，<em>e</em> 前面必须不是点号（.）
   （例如，<em>3.e3</em> 必须写作
   <em>3.0e3</em> 或 <em>3e3</em>）。
   另外，空字符串不再被视作有效的 JSON 字符串。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.other.internal-function-failure-overflow">
  <h4 class="title">在数值溢出的时候，内部函数将会失败</h4>

  <p class="para">
   将浮点数转换为整数的时候，如果浮点数值太大，导致无法以整数表达的情况下，
   在之前的版本中，内部函数会直接将整数截断，并不会引发错误。
   在 PHP 7.0 中，如果发生这种情况，会引发 E_WARNING 错误，并且返回 <strong><code>NULL</code></strong>。
  </p>
 </div>

 <div class="sect3" id="migration70.incompatible.other.fixes-custom-session-handler">
  <h4 class="title">自定义会话处理器的返回值修复</h4>

  <p class="para">
   在自定义会话处理器中，如果函数的返回值不是 <strong><code>FALSE</code></strong>，也不是 <em>-1</em>，
   会引发致命错误。现在，如果这些函数的返回值不是布尔值，也不是 <em>-1</em> 
   或者 <em>0</em>，函数调用结果将被视为失败，并且引发 E_WARNING 错误。
  </p>
 </div>
 
 <div class="sect3" id="migration70.incompatible.other.sort-order">
  <h4 class="title">相等的元素在排序时的顺序问题</h4>
  <p class="para">
   由于内部排序算法进行了提升，
   可能会导致对比时被视为相等的多个元素之间的顺序不稳定。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    在对比时被视为相等的多个元素之间的排序顺序是不可信赖的，即使是相等的两个元素，
    他们的位置也可能被排序算法所改变。
   </p>
  </p></blockquote>
 </div>
</div>



</div><hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="migration70.html">从PHP 5.6.x 移植到 PHP 7.0.x</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="migration70.new-features.html">新特性</a></div>
 <div class="up"><a href="migration70.html">从PHP 5.6.x 移植到 PHP 7.0.x</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
